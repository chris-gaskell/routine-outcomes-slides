---
from: markdown+emoji
format:
  revealjs:
    include-in-header: 
      text: |
        <meta name="github-repo" content="chris-gaskell/routine-outcomes-slides"/>
        <meta name="twitter:title" content="The effectiveness of psychological tnterventions in routine practice"/>
        <meta name="twitter:description" content="The effectiveness of psychological tnterventions in routine practice"/>
        <meta name="twitter:url" content="https://fnd-for-aps.netlify.app"/>
        <meta name="twitter:image" content="https://github.com/chris-gaskell/fnd-for-aps/blob/master/twitter-pic.jpg?raw=true"/>
        <meta name="twitter:image:alt" content="The effectiveness of psychological tnterventions in routine practice, 06/03/2023."/>
        <meta name="twitter:card" content="summary_large_image"/>
        <meta name="twitter:creator" content="@chrisgaskell92/>
        <meta name="twitter:site" content="@chrisgaskell92"/>
    smaller: false
    scrollable: true
    slide-tone: false
    incremental: false
    theme: [simple, custom.scss]
    preview-links: false
    preload-iframes: false
    chalkboard: true
    institute: "University of Sheffield"
    footer: "Effectiveness of Routine Psychological Interventions"
    transition: slide
    background-transition: fade
    transition-speed: slow
    footnotes-hover: true
    fig-cap-location: top
---

## The Effectiveness of Psychological Interventions in Routine Practice {style="font-size: 35px; text-align: center;"}

::: {style="text-align: center"}
*A research seminar for:*
:::

**The University of Sheffield Psychology**

::: {style="text-align: center"}
[routine-therapy-outcomes.netlify.app](routine-therapy-outcomes.netlify.app){.uri style="text-align: center"}
:::

![](https://images.unsplash.com/photo-1507537362848-9c7e70b7b5c1?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=2340&q=80){fig-align="center" width="500" height="300"}

------------------------------------------------------------------------

::: columns
::: {.column width="50%" style="text-align: center"}
![](https://pbs.twimg.com/profile_images/1434417640920002563/ZS62zhXl_400x400.jpg){style="border-radius: 50%; box-shadow: 0 0 30px black;" width="240"}

### Dr. Chris Gaskell

::: {style="font-size: 24px; text-align: center"}
Senior Clinical Psychologist

Neuropsychology

North Staffordshire Combined Healthcare NHS Trust
:::

::: {.column width="50%" style="text-align: center"}
:::
:::
:::

------------------------------------------------------------------------

## Disclaimers

-   I'm learning too[^1] :student:

[^1]: Acknowledgements: to supervisors and co-authors: Dr Steve Kellett, Dr Mel Simmons-Buckley & Dr Jaime Delgadillo.

## Aims For This Talk {background-color="#01364C"}

::: columns
::: {.column width="50%"}
-   Overview of effectiveness research.

-   Rationale for the current study.

-   Findings & Limitations.

-   Provide thoughts on next steps.

-   Tiny overview of meta-analysis.
:::
:::

::: {style="text-align: center; padding: 200px 0;"}
# Background {background-color="#01364C"}
:::

## What are the Highlights of Psychotherapy Research?

-   Vast number of RCTs demonstrating that the therapy is efficacious.

-   Specific therapies tend to fare about equal (I.e., Dodo bird effect).

-   Some therapists produce greater outcomes than others ('super shrinks'?).

-   Providing feedback tends to be a good thing.

## The problems with RCTs?

::: columns
::: {.column width="50%"}
Advantages of RCTs

-   :white_check_mark: Reduction of bias

-   :white_check_mark: High internal validity

-   :white_check_mark: Generalizability

-   :white_check_mark: Reproducibility

-   :white_check_mark: Objective and reliable
:::

::: {.column width="50%"}
::: incremental
**However:**

-   :x: High cost and resource-intensive
-   :x: Ethical issues
-   :x: Limited external validity
-   :x: Limited scope
-   :x: Unrepresentative samples
:::
:::
:::

::: notes
**Advantages**:

1.  **Reduction of bias:** RCTs use randomization to allocate participants into different groups, which helps reduce bias and ensure that the groups are comparable in terms of baseline characteristics.
2.  **High internal validity:** RCTs are considered the gold standard for evaluating the efficacy of interventions because they provide high internal validity, which means that they can establish causality between the intervention and the outcome.
3.  **Generalizability:** RCTs typically involve a diverse sample of participants, which increases the generalizability of the findings to the wider population.
4.  **Reproducibility:** RCTs provide a clear and detailed protocol for how the study was conducted, which allows other researchers to reproduce the study and test the results.
5.  **Objective and reliable:** RCTs use standardized methods to collect data, which ensures that the results are objective and reliable.

**Disadvantages:**

1.  **High cost and resource-intensive:** RCTs can be expensive and time-consuming, requiring significant funding and resources to conduct.
2.  **Ethical issues:** In some cases, RCTs may involve withholding treatment from participants in the control group, which can raise ethical concerns.
3.  **Limited external validity:** RCTs are often conducted in a highly controlled setting and may not fully reflect the real-world conditions in which the intervention will be used.
4.  **Limited scope:** RCTs are often designed to test a specific intervention, which means that they may not provide a comprehensive understanding of the broader context or underlying mechanisms.
5.  **Unrepresentative samples:** RCTs may exclude certain groups of people, such as those with comorbidities or those who are pregnant, which can limit the generalizability of the results to those groups.
:::

## Transporting

Important to continually monitor that treatments work under the conditions that they are purposefully designed for.

Many reasons to assume that the effects of psychotherapy delivered in routine care settings may differ from those observed in clinical trials:

-   Geographical effects

-   Provision

-   EBP

-   Integrity

However, similar treatment outcomes often found between efficacy trials and routine practice (e.g., Lutz et al., 2016; Persons et al., 1999).

## Hour Glass Model

![Salkovskis, P. M. (1995). Demonstrating specific effects in cognitive and behavioural therapy, in M. Aveline & D. Shapiro (Eds.), Research foundations for psychotherapy practice (pp. 191--228). Chichester, UK: Wiley. Taken from BABCP: https://babcp.com/Therapists/A-Cognitive-Behavioural-Therapists-Guide-to-Evidence](files/img/hour-glass.jpg)

::: notes
Paul Salkovskis has proposed an hour-glass model of psychological treatment, which is a variation of the hour-glass model of research. The model outlines the process of psychological treatment, from the initial assessment to the termination of treatment.

The hour-glass model of psychological treatment proposed by Paul Salkovskis typically involves the following stages:
:::

## What is Practice-Based Research {background-color="white"}

::: columns
::: {.column width="50%"}
![](files/img/barkham-book.jpeg){style="box-shadow: 0 0 20px black;" width="398"}
:::

::: {.column width="50%"}
![](files/img/shaddish.jpg){style="box-shadow: 0 0 0px black;" width="600" height="600"}
:::
:::

## Do Finding Hold in Routine Practice

-   Findings are encouraging

    -   Barkham paper. Jane Cahill1*, Michael Barkham2 and William B. Stiles. Psychological treatment conducted in routine clinic settings is effective for a range of client problems, particularly common mental health problems (uncontrolled effect size 1⁄4 1:29; 95% CI 1⁄4 1:26–1:33, N 1⁄4 10;842). When benchmarked against data from efficacy studies, practice-based studies yielded effect sizes that fell short of the selected benchmark. In contrast, the practice-based studies achieved the benchmark for percentage of clients meeting a stringent criterion for recovery.

    -   Hans paper. Eva Hans Wolfgang Hiller. Method: We conducted a random effects meta-analysis of 34 nonrandomized effectiveness studies on outpatient individual and group CBT for adult unipolar depressive disorder. Standardized mean gain effect sizes are reported for end-of-treatment and 6-month follow-up effects for depression severity, dysfunctional cognitions, general anxiety, psychological distress, and functional impairment. The mean dropout rate from CBT is reported. We benchmarked our results against high-quality randomized controlled trials (RCTs). Results: Outpatient CBT was effective in reducing depressive severity in completer (d 􏰀 1.13) and intention-to-treat (ITT) samples (d 􏰀 1.06). Moderate to large posttreatment effect sizes (d 􏰀 0.67–0.88) were found for secondary outcomes. The weighted mean dropout rate was 24.63%. Posttreatment gains for depression were maintained at 6 months after completion of therapy. Effect sizes for depression were inferior to those of benchmark RCTs. Conclusions: Although clinical practice patients show lesser improvements in depressive symptoms than RCT patients, individual and group outpatient CBT can be effectively transported to routine clinical practice. The considerable treatment dropout rate, especially in individual CBT, must be improved. The small number of available studies and low quality of some reports stress the need for high-quality effectiveness studies.

    -   Hunsley Paper (Narrative Review). John Hunsley, Katherine Elliott, and Zoé Therrien. We provide a narrative review of the extensive evidence that supports the efficacy and effectiveness of psychological treatments, across the life span, for common mental health disorders. To this end, relying primarily on meta-analytic studies, we examine the effects of psychological treatments for depression, bipolar disorder, generalised anxiety disorder, social anxiety disorder, specific phobia, panic disorder, obsessive–compulsive disorder, and posttraumatic stress disorder. Based upon data from hundreds of studies and thousands of participants, there is substantial evidence for both the efficacy and effectiveness of specific forms of psychological intervention for these disorders. Moreover, for most disorders, the clinical impact of specific forms of psychological treatment has been found to be at least equal to that of medication. Accordingly, the research evidence strongly supports the use of a number of specific psychological treatments, most of which are cognitive– behavioural treatments, as first-line interventions for these commonly occurring mental disorders among youth, adults, and older adults.
    
    - van Ingen paper. Daniel J. van Ingen University of Saint Thomas, Stacy R. Freiheit, Christopher S. Vye. A controversy exists over whether results of randomized controlled trials of psychological treatment methods generalize to routine clinical practice. To examine the generalizability of cognitive–behavioral interventions for anxiety disorders, a meta-analysis of 11 effectiveness studies was conducted. Only studies that closely approximated real-world clinical practice were included in the present meta-analysis (e.g., studies were conducted in a nonuniversity setting, practitioners had regular caseloads, clients were not excluded if they had comorbid conditions). Cognitive– behavioral interventions were associated with significant improvement in anxiety symptoms at the end of treatment (dw 􏰀 1.35) and again at follow-up (dw 􏰀 1.14). On the basis of these results, it seems that cognitive–behavioral interventions for anxiety disorders generalize to real-world clinical practice.
    
    - Stewart paper. Stewart and Dianne L. Chambless. The efficacy of cognitive–behavioral therapy (CBT) for anxiety in adults is well established. In the present study, the authors examined whether CBT tested under well-controlled conditions generalizes to less-controlled, real-world circumstances. Fifty-six effectiveness studies of CBT for adult anxiety disorders were located and synthesized. Meta-analytic effect sizes are presented for disorder-specific symptom measures as well as symptoms of generalized anxiety and depression for each disorder, and benchmarked to results from randomized controlled trials. All pretest–posttest effect sizes for disorder- specific symptom measures were large, suggesting that CBT for adult anxiety disorders is effective in clinically representative conditions. Six studies included a control group, and between-groups compar- isons yielded large effect sizes for disorder-specific symptoms in favor of CBT. Benchmarking indicated that results from effectiveness studies were in the range of those obtained in selected efficacy trials. To test whether studies that are more representative of clinical settings have smaller effect sizes, the authors coded studies for 9 criteria for clinical representativeness. Results indicate an inverse relationship between clinical representativeness and outcome, but the magnitude of the relationship is quite small.

- Shaddish paper 2000. 90 studies. Effects increase with larger dose and when outcomes are specific to treatment. 

The considerable growth of the PBE literature in the last decade and Implementation of empirically supported treatments across many settings warrants a comprehensive review of treatment outcomes data.

Aim = Updated review of available PBE studies. The objectives of the study were to:

1.  Establish that treatments are effective.
2.  Provide benchmarks so that services can compare
3.  Examine sources of heterogeneity using moderator variables

::: {style="text-align: center; padding: 200px 0;"}
# Method {background-color="#01364C"}
:::

## What is a Meta-Analysis? {background-color="white"}

-   Extract the effect-size from each study, and pool the results into a single effect.

-   Throwing everything into a bucket and seeing what comes out.

-   Problem: **Statistical Dependence**

-   Various possible solutions

    -   Multiple meta-analyses!

![](files/img/buckets.jpg){fig-align="center"}

## Search Criteria

```{r}
#| include: true
#| eval: true
#| label: tbl-search-criteria
#| tbl-cap: "Search criteria used in the systematic review."
library(tidyverse)
library(gt)

gt::as_raw_html(
tribble(
  ~Effectiveness, ~Psychological, ~Limiters,
"‘Practice based evidence’", "Psycho* OR Therap [PsycInfo]", "English Language",
"‘Routine practice’", "Psycho* [CINAHL and MEDLINE]", "Adult Sample",
"Benchmarking", NA, NA,
"Transportability", NA, NA,
"Transferability", NA, NA,
"Clinical* representat", NA, NA,
"’External valid* N0 findings", NA, NA,
"Applicab* N0 findings", NA, NA,
"Applicab* N0 intervention*", NA, NA,
"’Empiric* support’ N0 treatment", NA, NA,
"’Empiric* support’ N0 intervention", NA, NA,
"’Clinical* Effective*’", NA, NA,
"Dissem* N0 treatment*", NA, NA,
"Dissem* N0 intervention*", NA, NA,
"‘Clinical Practice’ N0 intervention*", NA, NA,
"‘Clinical Practice’ N0 treatment*", NA, NA,
"’Service deliv’ N0 intervention", NA, NA,
"’Service deliv’ N0 treatment", NA, NA,
"’Clinical* effective’ N2 evaluat", NA, NA,
"’Service deliv’ N0 evaluat", NA, NA,
"Transporting", NA, NA,
"‘Managed care setting’", NA, NA,
"Uncontrolled", NA, NA,
"‘Community clinic’", NA, NA,
"‘Community mental health centre’", NA, NA,
"‘Clinic setting’", NA, NA,
"‘Service setting’", NA, NA
) %>% 
  gt() %>% 
    tab_options(
    #row_group.background.color = "grey",
    row_group.font.size = 18,
    row_group.font.weight = "bold",
    column_labels.font.weight = "bold",
    table.font.size = 18,
    data_row.padding = px(6),
    table.width = pct(90),
    row_group.padding = px(5)
  ) %>%
  sub_missing(columns = 1:3, missing_text = "") %>%
  gt::opt_row_striping(row_striping = T) %>%
  opt_stylize(style = 6, color = "gray")

)

```

## Moderators

```{r}
#| include: true
#| eval: true
#| label: tbl-moderator-definitions
#| tbl-cap: "Moderators used in the systematic review."

gt::as_raw_html(
tribble(
  ~Moderator,                         ~Type,              ~Levels,        ~Notes,
    "Setting",                       "Categorical", "a) Outpatient<br>b) Inpatient<br>c) Mixed", NA,
    "Analysis",                      "Categorical", "a) Included all patients<br>b) Only completers", NA,
    "Severity",                      "Categorical", "a) **Mild** services (primary care, physical health, university counselling, voluntary, private, EAP).<br>b) **Moderate** services (secondary care, CMHTs, specialist psychotherapy centers, managed care settings, or intensive outpatient programmes).<br>c) **Severe** services (inpatient samples).<br>d) **University** clinics (outpatient and training clinics).", NA,
    "Modality",                      "Categorical", "a) **Cognitive-behavioral**.<br>b) **Psychodynamic Treatments**.<br>c) **Counselling** (e.g., person-centred, undefined).<br>d) **Other**.", "based on manuscript self-designation (i.e., if the manuscript described treatment as CBT, then that was coded). In the absence of these terms, modality of best-fit was decided using treatment descriptions. ",
    "Continent",                      "Categorical", "a) North America.<br>b) United Kingdom (UK).<br>c) Mainland Europe.<br>d) Australasia.<br>e) Asia", "The UK was separated from Europe because of the high representation of outcomes research coming from the UK",
    "Intervention Development Stage", "Categorical", "a) Preliminary studies (i.e., novel treatments/conditions).<br>b) Routine evaluations.", NA,
    "Experience",                     "Categorical", "a) Trainees.<br>b) Qualified professionals.", NA,
    "Measurement Tool",               "Categorical", NA, "Measures that were represented at least ten times in the systematic review",
    "Sample Size",                   "Categorical", "a) Small (N ≤ 25).<br>b) Medium (N = 25–50).<br>c) large (N = 50+)", NA,
    "Age",                            "Continuous", "Mean average age of sample", NA,
    "Year",                           "Continuous", "Year of publication", NA,
    "Females",                        "Continuous", "Rate of females (%)", NA,
) %>%
  group_by(Type) %>% 
   gt() %>% 
  fmt_markdown(columns = everything()) %>%
  tab_options(
    row_group.background.color = "grey",
    row_group.font.size = 18,
    row_group.font.weight = "bold",
    column_labels.font.weight = "bold",
    table.font.size = 18,
    data_row.padding = px(6),
    table.width = pct(90),
    row_group.padding = px(5)
  ) %>%
  sub_missing(columns = 1:4, missing_text = "") %>%
  gt::opt_row_striping(row_striping = T) %>%
  opt_stylize(style = 6, color = "gray") %>%
  cols_width(
    Moderator ~ px(50),
    Type ~ px(50),
    Levels ~ px(150),
    Notes ~ px(150),
  )
)

```

::: {style="text-align: center; padding: 200px 0;"}
# Findings {background-color="#01364C"}
:::

## Prisma {background-color="white"}

![Prisma flow diagram of studies throughout the review](files/img/prisma.jpg){#fig-surus alt="Prisma flow diagram of studies throughout the review" fig-align="center"}

## Overall Summary ES

```{r}
#| include: true
#| eval: true
#| label: tbl-summary-es
#| tbl-cap: "Sub-group (categorical) moderator analyses for depression outcomes."

gt::as_raw_html(
tribble(
  ~Moderator, ~k,	  ~d,	~Lower,	~Upper,	~p,	~I2,	~Q,
"Depression",	140,	0.96,	0.90,	1.06,	 "< 0.001",	98.40,	3037.46,
"Anxiety",  	84,	  0.80,	0.73,	0.92,	 "< 0.001",	97.52,	1488.88,
"General",  	184,	1.01,	0.93,	1.08,	 "< 0.001",	98.92,	15685.18
) %>% 
  #group_by(moderator) %>% 
  gt()  %>%
  tab_options(
    #row_group.background.color = "grey",
    row_group.font.size = 18,
    row_group.font.weight = "bold",
    column_labels.font.weight = "bold",
    table.font.size = 18,
    data_row.padding = px(10),
    table.width = pct(90),
    row_group.padding = px(5)
  ) %>%
  sub_missing(columns = 1:8, missing_text = "-") %>%
  gt::opt_row_striping(row_striping = T) %>%
  opt_stylize(style = 6, color = "gray") %>%
   fmt_markdown(columns = everything())
  # tab_source_note(
  #   source_note = md())
)
```

## Moderators

------------------------------------------------------------------------

## Depression

```{r}
#| include: false
#| eval: false
#| label: tbl-moderator-depression
#| tbl-cap: "Sub-group (categorical) moderator analyses for depression outcomes."

dat.depression <- 
   tribble(
        ~level,                  ~K,      ~SMD,      ~Q,           ~I2,      ~upper, ~lower,     ~mod,
        "mild",                   34,    1.03,     9550225.84,    "100%",     1.22, 0.85,        "severity",
        "university",             30,    0.98,     43207.72,      "100%",     1.16, 0.79,        "severity",
        "Secondary",              57,    0.98,     80913.95,      "100%",     1.11, 0.86,        "severity",
        "Residential",            15,    0.91,     237284.01,     "100%",     1.12, 0.7,        "severity",
        "include",                81,    0.93,     9730935.19,    "100%",     1.03, 0.84,        "analysis",
        "Completers",             59,    1.08,     221034.47,     "100%",     1.22, 0.94,        "analysis",
        "Outpatient",             121,    0.99,     9660158.7,    "100%",     1.08, 0.91,        "setting",
        "Residential",            16,    0.92,     240002.33,     "100%",     1.12, 0.72,        "setting",
        "N.America",              58,    1,     640493.04,        "100%",     1.11, 0.88,        "continent",
        "UK",                     44,    1.1,     3564904.55,     "100%",     1.26, 0.94,        "continent",
        "Europe",                 29,    0.95,     60424.34,      "100%",     1.12, 0.77,        "continent",
        "Australasia",            4,    0.67,     7087.67,        "100%",     1.01, 0.33,        "continent",
        "Asia",                   5,    0.59,     91.78,          "96%",      0.8, 0.37,        "continent",
        "psychodynamic",          24,    1.03,     41984.43,      "100%",     1.2, 0.86,        "therapy modality",
        "Counselling",            6,    0.89,     3471906.01,     "100%",     1.1, 0.69,        "therapy modality",
        "cognitive-behavioural",  90,    1,     393181.5,         "100%",     1.11, 0.89,        "therapy modality",
        "Other",                  20,    0.96,     307948.08,     "100%",     1.17, 0.75,        "therapy modality",
        "routine evaluations",    118,    1,     9955258.72,      "100%",     1.09, 0.91,        "Tretament stage",
        "preliminary studies",    22,    0.95,     546.66,        "96%",     1.12, 0.78,        "Tretament stage",
        "qualified",              121,    1.01,     9878905.77,   "100%",     1.1, 0.92,        "experience",
        "trainees",               19,    0.9,     76281.83,       "100%",     1.06, 0.74,        "experience",
        "BDI",                    34,    1.02,     121013.68,     "100%",     1.18, 0.86,        "measure",
        "PHQ-9",                  30,    1.01,     3495045.61,    "100%",     1.22, 0.81,        "measure",
        "large",                  74,    1.02,     9949550,       "100%",     1.13, 0.91,        "sample size",
        "small",                  33,    0.85,     625.88,        "95%",     0.99, 0.7,          "sample size",
        "",                       124,    -.001,     NA,           NA,     NA,  NA,            "publication year",
        "",                       124,    -.004,     NA,           NA,     NA,  NA,            "sample age",
        "",                       124,    0.13,      NA,           NA,     NA,  NA,              "% female",
        ) %>% 
  mutate(
    mod = str_to_title(mod),
    level = str_to_title(level),
    level = recode(level, "Uk" = "UK", "N.america" = "North America", "Europe" = "Mainland Europe",
                   "Bdi" = "BDI", "Phq-9" = "PHQ 9"),
    )

gt::as_raw_html(
dat.depression %>% 
  mutate("ci" = paste(lower, upper, sep = "-"),
         es = SMD) %>% 
  group_by(mod) %>% 
  gt(rowname_col = "level") %>%
    cols_hide(columns = c(Q, upper, lower))  %>%
  tab_options(
    #row_group.background.color = "grey",
    row_group.font.size = 16,
    row_group.font.weight = "bold",
    column_labels.font.weight = "bold",
    table.font.size = 14,
    data_row.padding = px(6),
    table.width = pct(85),
    row_group.padding = px(4)
  ) %>%
    cols_label(
    ci = "95% CI",
    es = "Cohen's d") %>% 
    tab_header(
    title = md("**Depression** Outcomes"),
  ) %>%
    cols_align(
    align = "center",
    columns = c(2:10)
    ) %>%
  # tab_style(
  #       style = cell_text(align = "left", indent = px(30)),
  #       locations = cells_stub()
  #   ) %>% 
  sub_missing(columns = 1:7, missing_text = "-") %>%
  gt::opt_row_striping(row_striping = T) %>%
  opt_stylize(style = 6, color = "red") %>%
gtExtras::gt_plt_conf_int(es, ci_columns = c(lower, upper), text_size = 2, ref_line = 0.96, width = 100,
  palette = c("grey", "lightgrey", "black", "red"),
text_args = list(accuracy = .01)
  ) %>%
cols_align(
  align = "center",
  columns = c(2:10)
 )  %>%
  tab_source_note(
    source_note = md("*d* = 0.96, *k* = 124, Tau<sup>2</sup> = 0.17[SE = 0.02], I<sup>2</sup> = 99.99%, R<sup>2</sup> = 19.28%")
    ) %>% 
   fmt_markdown(columns = everything())

) 

```

------------------------------------------------------------------------

##  {background-color="white" style="color: red"}

```{r}
#| include: false
#| eval: false
#| label: fig-moderator-depression
#| fig-cap: "Sub-group (categorical) moderator analyses for depression outcomes."
#| fig-width: 25
#| fig-height: 18

dat.depression %>%
  arrange(mod, level) %>% 
  mutate(level = recode(level, "Include" = "All starting treatment")) %>%
  filter(level != "" ) %>%
  ggplot(aes(x = level, y = SMD)) +
  geom_point() +
  geom_errorbar(aes(ymin = lower, ymax = upper)) +
  geom_hline(aes(yintercept = 0.96), linetype = "dashed", color = "red", linewidth = 1.4) +
  geom_hline(aes(yintercept = 0), linetype = "dashed", color = "black", linewidth = 1.4) +
  scale_y_continuous(n.breaks = 10) +
  facet_grid(
    rows = vars(mod),
    scales = "free", space = "free", labeller =
      labeller(mod = label_wrap_gen(8))
  ) + 
  coord_flip() +
  theme_bw() +
  labs(x = "Sub-group moderator level", y = paste("Cohen's d"), caption = "Note. red line = pooled effect-size; blue line = 0 (no effect)") +
  theme(strip.text.y.right = element_text(angle = 270, size = 21, colour = "white", face = "bold"),
        strip.background = element_rect(colour="black",
                                        fill="red"),
        strip.placement = "left",
        legend.position = "bottom",
        plot.title.position = "plot",
        text = element_text(size = 22),
        #strip.text = element_text(face = "bold", size = 12),
        axis.text.x = element_text(size = 22),
        panel.grid.minor = element_blank()
   )

```

------------------------------------------------------------------------

## Anxiety

```{r}
#| include: false
#| eval: false
#| label: tbl-moderator-anxiety
#| tbl-cap: "Sub-group (categorical) moderator analyses for anxiety outcomes."
 dat.anxiety <- 
   tribble(
        ~level,                   ~K,  ~SMD,   ~Q,           ~I2,    ~upper, ~lower,    ~mod,
        "mild",                  22,   0.99,  334405.48,   "100%",  1.2,     0.79,   "severity",
        "Secondary",             24,   0.63,  30702.22,    "100%",  0.76,    0.5,    "severity",
        "Residential",            8,    0.59,  108223.63,   "100%",  0.9,     0.29,   "severity",
        "university",            29,   1.01,  32067.93,    "100%",  1.2,     0.83,   "severity",
        "include",               58,   0.81,  517063.05,   "100%",  0.93,    0.69,   "analysis",
        "Completers",            26,   0.96,  92492.19,    "100%",  1.14,    0.77,   "analysis",
        "Outpatient",            75,   0.89,  440122.14,   "100%",  0.99,    0.78,   "setting",
        "Residential",           9,    0.58,  157933.03,   "100%",  0.85,    0.31,   "setting",
        "N.America",             32,   0.91,  230641.72,   "100%",  1.1,     0.72,   "continent",
        "UK",                    25,   0.89,  115765.33,   "100%",  1.09,    0.7,    "continent",
        "Europe",                20,   0.79,  27960.45,    "100%",  0.93,    0.65,   "continent",
        "Australasia",           4,    0.61,  3781.78,     "100%",  1.01,    0.21,   "continent",
        "Asia",                  3,    0.59,  3.33,        "40%",   0.68,    0.49,   "continent",
        "psychodynamic",        12,    0.9,   11879.61,    "100%",   1.04,   0.75,   "therapy modality",
        "Counselling",          2,     0.43,  28.37,        "96%",   0.49,   0.38,   "therapy modality",
        "cognitive-behavioural",62,    0.87,  174811.7,    "100%",      1,   0.74,   "therapy modality",
        "Other",                8,     0.75,  155956.84,    "100%",  0.97,   0.53,   "therapy modality",
        "routine evaluations",  74,    0.85,  635244.53,    "100%",  0.96,   0.74,   "Tretament stage",
        "preliminary studies",  10,    0.87,  639.27,       "99%",   1.14,   0.61,   "Tretament stage",
        "qualified",            66,    0.78,  502201.12,    "100%",  0.88,   0.68,   "experience",
        "trainees",             18,    1.12,  59913.29,     "100%",  1.39,   0.86,   "experience",
        "BAI",                  19,    0.71,  36173.3,      "100%",  0.88,   0.54,   "measure",
        "GAD-7",                19,    0.96,  241386.08,    "100%",  1.15,   0.78,   "measure",
        "large",                45,    0.84,  635426.98,    "100%",  0.95,   0.72,   "sample size",
        "medium",               13,    0.93,  2069.64,      "99%",    1.3,   0.57,   "sample size",
        "small",                26,    0.84,  898.19,       "97%",   1.03,   0.66,   "sample size",
        "",                     78,    0.01,       NA,       NA,     NA,  NA,            "publication year",
        "",                     78,    -0.01,      NA,       NA,     NA,  NA,            "sample age",
        "",                     78,    -0.22,      NA,       NA,     NA,  NA,              "% female"
        ) %>% 
  mutate(
    mod = str_to_title(mod),
    level = str_to_title(level),
    level = recode(level, "Uk" = "UK", "N.america" = "North America", "Europe" = "Mainland Europe",
                   "Bai" = "BAI", "Gad-7" = "GAD 7"),
    ) 
   
#gt::as_raw_html(
dat.anxiety %>% 
  mutate("ci" = paste(lower, upper, sep = "-"),
         es = SMD) %>% 
  group_by(mod) %>% 
  gt(rowname_col = "level") %>%
    cols_hide(columns = c(Q, upper, lower))  %>%
  tab_options(
    #row_group.background.color = "grey",
    row_group.font.size = 16,
    row_group.font.weight = "bold",
    column_labels.font.weight = "bold",
    table.font.size = 14,
    data_row.padding = px(6),
    table.width = pct(85),
    row_group.padding = px(4)
  ) %>%
    cols_label(
    ci = "95% CI",
    es = "Cohen's d") %>% 
    tab_header(
    title = md("**Anxiety** Outcomes"),
  ) %>%
    cols_align(
    align = "center",
    columns = c(2:10)
    ) %>%
  # tab_style(
  #       style = cell_text(align = "left", indent = px(30)),
  #       locations = cells_stub()
  #   ) %>% 
  sub_missing(columns = 1:7, missing_text = "-") %>%
  gt::opt_row_striping(row_striping = T) %>%
  opt_stylize(style = 6, color = "blue") %>%
gtExtras::gt_plt_conf_int(es, ci_columns = c(lower, upper), text_size = 2, ref_line = 0.8, width = 100,
  palette = c("grey", "lightgrey", "black", "blue"),
text_args = list(accuracy = .01)
  ) %>%
cols_align(
  align = "center",
  columns = c(2:10)
 )  %>%
  tab_source_note(
    source_note = md("*d* = 0.8, *k* = 78, Tau<sup>2</sup> = 0.13[SE = 0.02], I<sup>2</sup> = 99.95%, R<sup>2</sup> = 40.55%")
    )
#)   

```

------------------------------------------------------------------------

## Anxiety Forest Plot {background-color="white"}

```{r}
#| include: false
#| eval: false
#| label: fig-moderator-anxiety
#| fig-cap: "Sub-group (categorical) moderator analyses for anxiety outcomes."
#| fig-width: 20
#| fig-height: 16

dat.anxiety %>%
  arrange(mod, level) %>% 
  mutate(level = recode(level, "Include" = "All starting treatment")) %>%
  filter(level != "" ) %>%
  ggplot(aes(x = level, y = SMD)) +
  geom_point() +
  geom_errorbar(aes(ymin = lower, ymax = upper)) +
  geom_hline(aes(yintercept = 0.80), linetype = "dashed", color = "red") +
  geom_hline(aes(yintercept = 0), linetype = "dashed", color = "blue") +
  scale_y_continuous(n.breaks = 10) +
  facet_grid(
    rows = vars(mod),
    scales = "free", space = "free", labeller =
      labeller(mod = label_wrap_gen(8))
  ) + 
  coord_flip() +
  theme_bw() +
  labs(x = "Sub-group moderator level", y = paste("Cohen's d"), caption = "Note. red line = pooled effect-size; blue line = 0 (no effect)") +
  theme(strip.text.y.right = element_text(angle = 270, size = 17),
        strip.placement = "left",
        legend.position = "bottom",
        plot.title.position = "plot",
        text = element_text(size = 20),
        #strip.text = element_text(face = "bold", size = 12),
        axis.text.x = element_text(size = 20),
        panel.grid.minor = element_blank()
   )

```

------------------------------------------------------------------------

## General

```{r}
#| include: false
#| eval: false
#| label: tbl-moderator-general
#| tbl-cap: "Sub-group (categorical) moderator analyses for general outcomes."

dat.general <- 
tribble(
 ~level,                   ~K,   ~SMD,      ~Q,       ~I2,      ~upper, ~lower, ~mod,
 "mild",                   61,   1.08,   39097618.6,  "100%",    1.21, 0.95,      "severity",
 "Secondary",              62,   0.98,   111313.98,   "100%",    1.12, 0.84,      "severity",
 "Residential",            27,   1.09,   66242.24,    "100%",    1.26, 0.91,      "severity",
 "university",             28,   0.82,   44711.91,    "100%",    0.95, 0.7,      "severity",
 "include",                95,   0.98,   12421993.52, "100%",    1.09, 0.87,      "analysis",
 "Completers",             89,   1.08,   10540486.3,  "100%",    1.18, 0.97,      "analysis",
 "Outpatient",             153,  1,   104250384.75,   "100%",    1.08, 0.92,      "setting",
 "Residential",            28,   1.08,   67693.6,     "100%",    1.25, 0.91,      "setting",
 "UK",                     68,   1.02,   92810921.73, "100%",    1.13, 0.92,      "continent",
 "N.America",              60,   1.07,   4606355.34,  "100%",    1.25, 0.9,      "continent",
 "Europe",                 47,   1,   157855.31,      "100%",    1.12, 0.88,      "continent",
 "Australasia",            4,    0.81,   330.52,      "99%",     0.9, 0.72,      "continent",
 "Asia",                   5,    0.9,   575.15,       "99%",     1.2, 0.61,      "continent",
 "cognitive-behavioural",  83,   1.18,   178432.53,   "100%",    1.32, 1.05,      "therapy modality",
 "psychodynamic",          36,   0.93,   49292.89,    "100%",    1.07, 0.79,      "therapy modality",
 "Counselling",            19,   0.9,   318722.49,    "100%",    1.06, 0.75,      "therapy modality",
 "Other",                  46,   0.87,   103700450.06,"100%",    0.98, 0.76,      "therapy modality",
 "preliminary studies",    24,   1.06,   4742.5,      "100%",    1.29, 0.82,      "Tretament stage",
 "routine evaluations",    160,  1.02,   104380709.35,"100%",    1.1, 0.94,      "Tretament stage",
 "qualified",              158,  1.07,   104283036.81,"100%",    1.16, 0.99,      "experience",
 "trainees",               26,   0.77,   71069.62,    "100%",    0.89, 0.65,      "experience",
 "BSI-GSI",                26,   0.87,   9966.85,     "100%",    1, 0.73,      "measure",
 "CORE-OM",                35,   1.04,   72198841.45, "100%",    1.18, 0.9,      "measure",
 "OQ-45",                  13,   0.57,   1090596.15,  "100%",    0.74, 0.41,      "measure",
 "SCL (Global)",           22,   1.05,   15779.11,    "100%",    1.23, 0.87,      "measure",
 "PCL",                    12,   1.29,   3642.32,     "100%",    1.61, 0.97,      "measure",
 "large",                  110,  1.01,   104379542.58,"100%",    1.1, 0.92,      "sample size",
 "medium",                 38,   1.11,   4366.03,     "99%",     1.3, 0.92,      "sample size",
 "small",                  36,   0.99,   1001.45,     "97%",     1.18, 0.81,      "sample size",
   "",                     153,  0.00,       NA,       NA,     NA,  NA,            "publication year",
   "",                     153,  -0.00,      NA,       NA,     NA,  NA,            "sample age",
   "",                     153,  -0.14,      NA,       NA,     NA,  NA,              "% female"
 )   %>% 
  mutate(
    mod = str_to_title(mod),
    level = str_to_title(level),
    level = recode(level, "Uk" = "UK", "N.america" = "North America", "Europe" = "Mainland Europe",
                   "Bsi-Gsi" = "BSI-GSI", "Scl (Global)" = "SCL (Global)",
                   "Core-Om" = "CORE-OM", "Pcl" = "PCL",
                   "Oq-45" = "OQ-45"),
    ) 

gt::as_raw_html(
dat.general %>% 
  mutate("ci" = paste(lower, upper, sep = "-"),
         es = SMD) %>% 
  group_by(mod) %>% 
  gt(rowname_col = "level") %>%
    cols_hide(columns = c(Q, upper, lower))  %>%
  tab_options(
    #row_group.background.color = "grey",
    row_group.font.size = 16,
    row_group.font.weight = "bold",
    column_labels.font.weight = "bold",
    table.font.size = 14,
    data_row.padding = px(6),
    table.width = pct(85),
    row_group.padding = px(4)
  ) %>%
    cols_label(
    ci = "95% CI",
    es = "Cohen's d") %>% 
    tab_header(
    title = md("**General** Outcomes"),
  ) %>%
    cols_align(
    align = "center",
    columns = c(2:10)
    ) %>%
  # tab_style(
  #       style = cell_text(align = "left", indent = px(30)),
  #       locations = cells_stub()
  #   ) %>% 
  sub_missing(columns = 1:7, missing_text = "-") %>%
  gt::opt_row_striping(row_striping = T) %>%
  opt_stylize(style = 6, color = "green") %>%
gtExtras::gt_plt_conf_int(es, ci_columns = c(lower, upper), text_size = 2, ref_line = 1.01, width = 100,
  palette = c("grey", "lightgrey", "black", "green"),
text_args = list(accuracy = .01)
  ) %>%
cols_align(
  align = "center",
  columns = c(2:10)
 )   %>%
  tab_source_note(
    source_note = md("*d* = 1.01, *k* = 153, Tau<sup>2</sup> = 0.24[SE = 0.03], I<sup>2</sup> = 100%, R<sup>2</sup> = 21.44%")
    )
)
```

------------------------------------------------------------------------

## General Outcomes Forest Plot {background-color="white"}

```{r}
#| include: false
#| eval: false
#| label: fig-moderator-general
#| fig-cap: "Sub-group (categorical) moderator analyses for general outcomes."
#| fig-width: 20
#| fig-height: 16

dat.general %>%
  arrange(mod, level) %>% 
  mutate(level = recode(level, "Include" = "All starting treatment")) %>%
  filter(level != "" ) %>%
  ggplot(aes(x = level, y = SMD)) +
  geom_point() +
  geom_errorbar(aes(ymin = lower, ymax = upper)) +
  geom_hline(aes(yintercept = 1.01), linetype = "dashed", color = "red") +
  geom_hline(aes(yintercept = 0), linetype = "dashed", color = "blue") +
  scale_y_continuous(n.breaks = 10) +
  facet_grid(
    rows = vars(mod),
    scales = "free", space = "free", labeller =
      labeller(mod = label_wrap_gen(8))
  ) + 
  coord_flip() +
  theme_bw() +
  labs(x = "Sub-group moderator level", y = paste("Cohen's d"), caption = "Note. red line = pooled effect-size; blue line = 0 (no effect)") +
  theme(strip.text.y.right = element_text(angle = 270, size = 17),
        strip.placement = "left",
        legend.position = "bottom",
        plot.title.position = "plot",
        text = element_text(size = 20),
        #strip.text = element_text(face = "bold", size = 12),
        axis.text.x = element_text(size = 20),
        panel.grid.minor = element_blank()
   )

```

## Benchmarks

```{r}
#| include: false
#| eval: false
#| label: tbl-moderator-benchmarks
#| tbl-cap: "Benchmarks for routine services based on individual study sample quartiles."

# dat.benchmarks <-
#   tribble(
# ~Group,       ~Domain,     ~Outpatient,	           ~Inpatient,	           ~UCC,                 ~"Uni Clinics",
# "Top 25%",    "Depression",	 "d = 1.68 [1.53-1.83]", "d = 1.34 [1.16-1.52]",  NA,                   "d = 1.77 [1.50-2.03]",
# "Top 25%",    "Anxiety",     "d = 1.56 [1.38-1.73", "d = 1.07 [1.04-1.09]",   NA,                   "d = 1.80 [1.57-2.02]",
# "Top 25%",    "Other",       "d = 1.70 [1.54-1.86]", "d = 1.67 [1.37-1.97]", "d - 1.47 [1.24-1.69]","d = 1.14 [1.10-1.18]",
# "Average",    "Depression",	 "d = 0.94 [0.90-0.97]", "d = 0.98 [0.81-1.15]",  NA,                   "d = 0.91 [0.87-0.95]",
# "Average",    "Anxiety",     "d = 0.84 [0.78-0.89]", "d = 0.67 [0.42-0.92]",  NA,                   "d = 1.80 [1.57-2.02]",
# "Average",    "Other",       "d = 0.92 [0.89-0.96]", "d = 1.04 [0.96-1.11]", "d = 0.94 [0.84-1.03]","d = 0.86 [0.77-0.94]",
# "Bottom 25%", "Depression",	 "d = 0.46 [0.41-0.52]", "d = 0.38 [0.26-0.5]",   NA,                    "d = 0.40 [0.27-0.54]",
# "Bottom 25%", "Anxiety",     "d = 0.37 [0.33-0.42]", "d = 0.13 [0.03-0.29]",  NA,                   "d = 0.51 [0.44-0.57]",
# "Bottom 25%", "Other",       "d = 0.49 [0.43-0.54]", "d = 0.58 [0.46-0.69]", "d = 0.64 [0.61-0.67]","d = 0.41 [0.23-0.59]",
# )



dat.benchmarks <-
  tribble(
~Group,       ~Domain,       ~Setting,           ~es,     ~lower, ~upper,
"Top 25%",    "Depression",	 "Outpatient",       1.68,   1.53,     1.83,    
"Top 25%",    "Anxiety",     "Outpatient",       1.56,   1.38,     1.73,    
"Top 25%",    "Other",       "Outpatient",       1.70,   1.54,     1.86,    
"Average",    "Depression",	 "Outpatient",       0.94,   0.90,     0.97,    
"Average",    "Anxiety",     "Outpatient",       0.84,   0.78,     0.89,    
"Average",    "Other",       "Outpatient",       0.92,   0.89,     0.96,    
"Bottom 25%", "Depression",	 "Outpatient",       0.46,   0.41,     0.52,    
"Bottom 25%", "Anxiety",     "Outpatient",       0.37,   0.33,     0.42,    
"Bottom 25%", "Other",       "Outpatient",       0.49,   0.43,     0.54,    
"Top 25%",    "Depression",	 "Inpatient",        1.34,   1.16,     1.52,    
"Top 25%",    "Anxiety",     "Inpatient",        1.07,   1.04,     1.09,    
"Top 25%",    "Other",       "Inpatient",        1.67,   1.37,     1.97,    
"Average",    "Depression",	 "Inpatient",        0.98,   0.81,     1.15,    
"Average",    "Anxiety",     "Inpatient",        0.67,   0.42,     0.92,    
"Average",    "Other",       "Inpatient",        1.04,   0.96,     1.11,    
"Bottom 25%", "Depression",	 "Inpatient",        0.38,   0.26,     0.5,      
"Bottom 25%", "Anxiety",     "Inpatient",        0.13,   0.03,     0.29,    
"Bottom 25%", "Other",       "Inpatient",        0.58,   0.46,     0.69,    
"Top 25%",    "Depression",	 "UCC",                NA,   NA,        NA,                     
"Top 25%",    "Anxiety",     "UCC",                NA,   NA,        NA,                    
"Top 25%",    "Other",       "UCC",             1.47 ,   1.24,     1.69,  
"Average",    "Depression",	 "UCC",                NA,  NA,         NA,         
"Average",    "Anxiety",     "UCC",                NA,  NA,         NA,         
"Average",    "Other",       "UCC",             0.94,    0.84,       1.03,  
"Bottom 25%", "Depression",	 "UCC",                NA,   NA,        NA,                  
"Bottom 25%", "Anxiety",     "UCC",                NA,   NA,        NA,                  
"Bottom 25%", "Other",       "UCC",              0.64,  0.61,      0.67,  
"Top 25%",    "Depression",	 "Uni Clinics",      1.77,  1.50,      2.03,
"Top 25%",    "Anxiety",     "Uni Clinics",      1.80,  1.57,      2.02,
"Top 25%",    "Other",       "Uni Clinics",      1.14,  1.10,      1.18,
"Average",    "Depression",	 "Uni Clinics",      0.91,  0.87,      0.95,
"Average",    "Anxiety",     "Uni Clinics",      1.80,  1.57,      2.02,
"Average",    "Other",       "Uni Clinics",      0.86,  0.77,      0.94,
"Bottom 25%", "Depression",	 "Uni Clinics",      0.40,  0.27,      0.54,
"Bottom 25%", "Anxiety",     "Uni Clinics",      0.51,  0.44,      0.57,
"Bottom 25%", "Other",       "Uni Clinics",      0.41,  0.23,      0.59
) %>% mutate(d = es,
             ci = paste(lower, upper, sep = "-")
) %>% relocate(Group, Domain, Setting, es, ci,  lower, upper)





gt::as_raw_html(
dat.benchmarks %>% 
  group_by(Setting) %>% 
  gt(rowname_col = "Domain") %>%
    cols_hide(columns = c(upper, lower))  %>%
  tab_options(
    #row_group.background.color = "grey",
    row_group.font.size = 16,
    row_group.font.weight = "bold",
    column_labels.font.weight = "bold",
    table.font.size = 14,
    data_row.padding = px(6),
    table.width = pct(85),
    row_group.padding = px(4)
  ) %>%
    cols_label(
    ci = "95% CI",
    es = "Cohen's d"
      ) %>% 
    tab_header(
    title = md("**Benchmarks**"),
  ) %>%
    cols_align(
    align = "center",
    columns = c(2:8)
    ) %>%
  # tab_style(
  #       style = cell_text(align = "left", indent = px(30)),
  #       locations = cells_stub()
  #   ) %>% 
  sub_missing(columns = 1:8, missing_text = "-") %>%
  gt::opt_row_striping(row_striping = T) %>%
  opt_stylize(style = 6, color = "pink") %>%
  gtExtras::gt_plt_conf_int(d, ci_columns = c(lower, upper), text_size = 2, ref_line = 1, width = 100,
  palette = c("grey", "lightgrey", "black", "pink"),
text_args = list(accuracy = .01)
  )
)
```

## Publication Bias

::: {style="text-align: center; padding: 200px 0;"}
# What it means {background-color="#01364C"}
:::

## How does this fit with other evidence

## Comparison to other PBE reviews

## Comparison to RCTs

::: {style="text-align: center; padding: 200px 0;"}
# Limitations {background-color="#01364C"}
:::

## the design

## Of the methods

## Of the Analysis

::: {style="text-align: center; padding: 200px 0;"}
# Shiny App {background-color="#01364C"}
:::

::: {style="text-align: center; padding: 200px 0;"}
# Lessons Learnt {background-color="#01364C"}
:::

## Lessons

Reproducible workflows. Project Management. Watertight protocol.
